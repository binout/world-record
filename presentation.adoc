= ğŸŒ Records du monde 
:source-highlighter: highlightjs
:revealjs_theme: white
:revealjs_history: true
:revealjs_plugin_pdf: enabled
:revealjs_plugin_highlight: enabled
:revealjs_progress: true
:customcss: custom.css
:data-uri:
:icons: font

== World Record

image::images/guinness.jpeg[]

== Record depuis Java 16

* JD4 14 : JEP 359 Records (Preview)
* JDK 15 : JEP 384 Records (Second Preview)
* JDK 16 : JEP 395: Records

[source, java]
----
public record MedalCount(int gold, int silver, int bronze)
----

== Des champs immutables

[source%linenums, java]
----
public record MedalCount(int gold, int silver, int bronze)

var medalCount = new MedalCount(1, 2, 3);
var gold = medalCount.gold;
var silver = medalCount.silver;
var bronze = medalCount.bronze;
----

[source%linenums, java]
----
public class MedalCount {
  private final int gold;
  private final int silver;
  private final int bronze;

  public MedalCount(int gold, int silver, int bronze) {
      this.gold = gold;
      this.silver = silver;
      this.bronze = bronze;
  }
  ....
}
----

== toString

[source, java]
----
public record MedalCount(int gold, int silver, int bronze)
----

[source%linenums, java]
----
public class MedalCount {
  private final int gold;
  private final int silver;
  private final int bronze;
  ....

  @Override
  public String toString() {
    return "MedalCount[gold=" + gold 
            + ", silver=" + silver 
            + ", bronze=" + bronze + "]";
  }
}
----

== equals / hasCode

[source, java]
----
public record MedalCount(int gold, int silver, int bronze)
----

[source%linenums, java]
----
public class MedalCount {
  private final int gold;
  private final int silver;
  private final int bronze;
  ....

  @Override
  public int hashCode() {
      return Objects.hash(gold, silver, bronze);
  }

  @Override
  public boolean equals(Object obj) {
      if (this == obj) {
          return true;
      } else if (!(obj instanceof MedalCount)) {
          return false;
      } else {
          MedalCount other = (MedalCount) obj;
          return Objects.equals(gold, other.gold)
            && Objects.equals(silver, other.silver)
            && Objects.equals(bronze, other.bronze);
      }
  }
}
----

== Benoit Prioux

icon:twitter[] icon:github[] binout 

image::images/alan-eng.jpeg[]

== De Java Ã  Python, en passant par Kotlin

image::images/timeline.png[]

== ğŸª± Avant les Records, Lombok

[source%linenums, java]
----
@Data
public class MedalCount {
    private final int gold;
    private final int silver;
    private final int bronze;
}

MedalCount medalCount = new MedalCount(1, 2, 3);
int gold = medalCount.getGold();
int silver = medalCount.getSilver();
int bronze = medalCount.getBronze();
----

== ğŸª± Avant les Records, Lombok

* ğŸ”— DÃ©pendance nÃ©cessaire
* ğŸª„ Configuration Annotation Processor
* ğŸ¤¯ Ouvre la porte Ã  d'autres fonctionnalitÃ©s

== ğŸªœ case class en Scala

[source, scala]
----
case class MedalCount(gold: Int, silver: Int, bronze: Int)
----

== ğŸ…º data class en Kotlin

[source, kotlin]
----
data class MedalCount(gold: Int, silver: Int, bronze: Int)
----

== ğŸ @dataclass en Python

[source, python]
----
@dataclass(Frozen=True)
class MedalCount:
  gold: int
  silver: int
  bronze: int
----

== Oui mais pourquoi faire ?

image::images/record-why.png[]

== ğŸ”€ Data Transfer Objects

* Objet de transport de donnÃ©e pour faciliter la sÃ©rialisation/dÃ©sÃ©rialisation
* FacilitÃ© d'Ã©criture avec les records

image::images/dto.png[]

== ğŸ”‘ ClÃ© dans une map

* Les records comme clÃ© composÃ©e pour une map

[source%linenums, java]
----
var countryPerMedals = 
        new HashMap<MedalCount, List<String>>();
countryPerMedals.put(
        new MedalCount(5, 2, 1), asList("us", "cn"));
countryPerMedals.put(
        new MedalCount(1, 1, 1), asList("fr", "de"));
----

== ğŸ“ Local records

[source%linenums, java]
----
public List<String> sortCountryByMedal(List<String> countries) {

  record Data(String country, MedalCount medalCount){}

  return countries.stream()
        .map(country -> 
                new Data(country, getMedalCount(country)))
        .sorted(Comparator.comparing(d -> d.medalCount))
        .map(Data::country)
        .collect(toList());
}
----

== ğŸ˜± Primitive Obsession - ProblÃ¨me 

* Utilisation de types primitifs pour modÃ©liser des "petits" objets 

[source%linenums, java]
----
public MedalCount getMedalCount(String country, 
                                String olympicGame, 
                                String sport) {
  ....
}

var medalCount = getMedalCount("FR", "14", "swimming"); âœ…
var medalCount = getMedalCount("14", "FR", "swimming"); ğŸ¤¯
----

== ğŸ’¡ Primitive Obsession - Record ! 

* `Identifier Type` pattern

[source%linenums, java]
----
public record CountryCode(String value)
public record OlympicGameId(String value)
public record SportName(String value)

public MedalCount getMedalCount(CountryCode countryCode, 
                                OlympicGameId olympicGameId, 
                                SportName sportName) {
  ....
}

var medalCount = getMedalCount(CountryCode("FR"), 
                               OlympicGameId("14"), 
                               SportName("swimming"));
----

== âœ… Validation des donnÃ©es

* Validation post contruction pour assurer des invariants mÃ©tier

[source%linenums, java]
----
public record MedalCount(int gold, int silver, int bronze) {

  public MedalCount {
    if (gold < 0 || silver < 0 || bronze < 0) {
      throw new IllegalArgumentException(
        "Medal count should be positive")
    }
  }
}
----

== Domain Driven Design

image::images/ddd.png[]


== Entity vs Value Object

* `Entity`: objet mÃ©tier avec une identitÃ© et un cycle de vie
* `Value Object`: objet mÃ©tier immutable et dÃ©fini par ses attributs

[quote]
====
ğŸ‰ Les records, solution idÃ©ale pour modÃ©liser les Value Objects ! ğŸ‰
====

== Et si on ajoutait des mÃ©thodes ?

TODO

== En route vers les monoides ?

TODO

== Pour quels problÃ¨mes ?

TODO


== Exemple 

TODO


== Et aprÃ¨s ? Le pattern matching ! 

TODO


== JEP 405 : Record Patterns (Preview)

https://openjdk.java.net/jeps/405

[source%linenums, java]
----
record Point(int x, int y) {}

void printSum(Object o) {
    if (o instanceof Point(int x, int y)) {
        System.out.println(x+y);
    }
}
----

== Pour conclure

TODO

